<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت گیم‌نت حرفه‌ای</title>
    <style>
        @font-face {
            font-family: 'B Titr';
            src: url('https://s2.uupload.ir/filelink/9hS8PS8W64gM_1473f3be7d/q9k2_2_titr.ttf') format('truetype');
        }
        body {
            font-family: 'B Titr', sans-serif;
            background: url('https://wallpaperaccess.com/full/1392898.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            margin: 0;
            padding: 20px;
            direction: rtl;
            overflow-x: hidden;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: -1;
        }
        .container {
            background: rgba(20, 20, 40, 0.85);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.5);
            width: 90%;
            max-width: 1300px;
            margin: 0 auto;
            position: relative;
        }
        h1 {
            text-align: center;
            color: #00ffcc;
            text-shadow: 0 0 15px #00ffcc, 0 0 25px #00ffcc;
            font-size: 2.5em;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #00ffcc; }
            to { text-shadow: 0 0 20px #00ffcc, 0 0 30px #00ffcc; }
        }
        .player {
            background: linear-gradient(45deg, #1a1a3a, #2a2a5a);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            transition: transform 0.3s ease;
            border: 2px solid #00ffcc;
            position: relative;
            z-index: 1;
        }
        .player:hover {
            transform: scale(1.03);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.7);
        }
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .player span {
            font-size: 1.4em;
            color: #ffeb3b;
            text-shadow: 0 0 5px #ffeb3b;
        }
        .timer {
            font-size: 1.2em;
            color: #00ffcc;
            margin-right: 20px;
        }
        .price-options {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-family: 'B Titr', sans-serif;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        button:hover::after {
            width: 200px;
            height: 200px;
        }
        .start-btn { background: #4caf50; color: #fff; }
        .start-btn:hover { background: #45a049; }
        .stop-btn { background: #f44336; color: #fff; }
        .stop-btn:hover { background: #da190b; }
        .reset-btn { background: #ff9800; color: #fff; }
        .reset-btn:hover { background: #e68a00; }
        .snack-btn { background: #2196f3; color: #fff; }
        .snack-btn:hover { background: #1e87db; }
        .price-btn { background: #9c27b0; color: #fff; padding: 8px 15px; font-size: 1em; }
        .price-btn:hover { background: #7b1fa2; }
        .price-btn.active { background: #e91e63; }
        .total {
            text-align: center;
            font-size: 2em;
            margin-top: 30px;
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc;
            background: rgba(20, 20, 40, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ffcc;
            position: relative;
            z-index: 1;
        }
        .income-btn, .admin-btn {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            background: #ff5722;
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .income-btn:hover, .admin-btn:hover { background: #e64a19; }
        /* استایل پاپ‌آپ */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a3a, #2a2a5a);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(0, 255, 204, 0.8), inset 0 0 20px rgba(0, 255, 204, 0.3);
            z-index: 1000;
            width: 400px;
            border: 3px solid #00ffcc;
            animation: popupFadeIn 0.3s ease-in-out;
        }
        @keyframes popupFadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        .popup h2 {
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc;
            margin-top: 0;
            font-size: 1.8em;
        }
        .popup-content div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 255, 204, 0.2);
        }
        .popup-content span {
            color: #ffeb3b;
            text-shadow: 0 0 5px #ffeb3b;
            font-size: 1.2em;
        }
        .popup-content button {
            padding: 5px 15px;
            font-size: 1em;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #f44336;
            color: #fff;
            padding: 5px 10px;
            border-radius: 50%;
            font-size: 1em;
        }
        .close-btn:hover { background: #da190b; }
        .snack-count {
            color: #ffeb3b;
            margin: 0 15px;
            font-size: 1.2em;
        }
        #incomePopup span, #adminPopup span {
            font-size: 1.5em;
            color: #ffeb3b;
        }
        #adminPopup input {
            padding: 5px;
            font-family: 'B Titr', sans-serif;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #00ffcc;
            background: #2a2a5a;
            color: #fff;
        }
        #adminPopup button {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="container">
        <h1>مدیریت گیم‌نت حرفه‌ای</h1>
        <div id="players"></div>
        <div class="total">مبلغ کل: <span id="grandTotal">0</span> تومان</div>
        <button class="income-btn" onclick="openIncomePopup()">درآمد امروز شما</button>
        <button class="admin-btn" onclick="openAdminPopup()">ادمین</button>
    </div>

    <div id="snackPopup" class="popup">
        <button class="close-btn" onclick="closePopup()">X</button>
        <h2>تنقلات</h2>
        <div id="popupContent" class="popup-content"></div>
    </div>

    <div id="incomePopup" class="popup">
        <button class="close-btn" onclick="closeIncomePopup()">X</button>
        <h2>درآمد امروز شما</h2>
        <div><span id="dailyIncome">0</span> تومان</div>
    </div>

    <div id="adminPopup" class="popup">
        <button class="close-btn" onclick="closeAdminPopup()">X</button>
        <h2>پنل ادمین</h2>
        <div id="adminContent" class="popup-content"></div>
    </div>

    <script>
        let rates = {
            old: 45000,    // قیمت قدیم
            new: 60000,    // قیمت جدید
            fourPlayers: 90000 // 4 دسته
        };
        let snacks = {
            "چیپس": 10000,
            "دوغ آبعلی": 27000,
            "دوغ مشگین": 9000,
            "کیک": 15000,
            "کرانچی": 12000
        };
        const players = 6;
        let intervals = {};
        let totals = Array(players).fill(0);
        let snackCounts = Array(players).fill().map(() => ({}));
        let timers = Array(players).fill(0);
        let hourlyRates = Array(players).fill(rates.old);
        let dailyIncome = 0;
        let currentPlayerIndex = null;
        let isAdminAuthenticated = false;

        // بارگذاری داده‌ها از localStorage
        function loadData() {
            const savedTotals = JSON.parse(localStorage.getItem("totals")) || Array(players).fill(0);
            const savedSnacks = JSON.parse(localStorage.getItem("snackCounts")) || Array(players).fill().map(() => ({}));
            const savedTimers = JSON.parse(localStorage.getItem("timers")) || Array(players).fill(0);
            const savedRates = JSON.parse(localStorage.getItem("hourlyRates")) || Array(players).fill(rates.old);
            dailyIncome = parseFloat(localStorage.getItem("dailyIncome")) || 0;
            rates = JSON.parse(localStorage.getItem("rates")) || rates;
            snacks = JSON.parse(localStorage.getItem("snacks")) || snacks;

            totals = savedTotals;
            snackCounts = savedSnacks;
            timers = savedTimers;
            hourlyRates = savedRates;
            updateGrandTotal();
            updateDailyIncome();
        }

        // ذخیره داده‌ها در localStorage
        function saveData() {
            localStorage.setItem("totals", JSON.stringify(totals));
            localStorage.setItem("snackCounts", JSON.stringify(snackCounts));
            localStorage.setItem("timers", JSON.stringify(timers));
            localStorage.setItem("hourlyRates", JSON.stringify(hourlyRates));
            localStorage.setItem("dailyIncome", dailyIncome);
            localStorage.setItem("rates", JSON.stringify(rates));
            localStorage.setItem("snacks", JSON.stringify(snacks));
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateGrandTotal() {
            const grandTotal = totals.reduce((a, b) => a + b, 0);
            document.getElementById("grandTotal").textContent = formatNumber(Math.round(grandTotal));
        }

        function updateDailyIncome() {
            document.getElementById("dailyIncome").textContent = formatNumber(Math.round(dailyIncome));
        }

        function createPlayer(index) {
            const playerDiv = document.createElement("div");
            playerDiv.className = "player";
            playerDiv.innerHTML = `
                <div>
                    <div class="player-info">
                        <span>P${index + 1}: <span id="total${index}">0</span> تومان</span>
                        <span class="timer" id="timer${index}">${formatTime(timers[index])}</span>
                    </div>
                    <div class="price-options">
                        <button class="price-btn ${hourlyRates[index] === rates.old ? 'active' : ''}" onclick="setRate(${index}, 'old')">قیمت قدیم</button>
                        <button class="price-btn ${hourlyRates[index] === rates.new ? 'active' : ''}" onclick="setRate(${index}, 'new')">قیمت جدید</button>
                        <button class="price-btn ${hourlyRates[index] === rates.fourPlayers ? 'active' : ''}" onclick="setRate(${index}, 'fourPlayers')">4 دسته</button>
                    </div>
                </div>
                <div>
                    <button class="start-btn" onclick="startTimer(${index})">روشن</button>
                    <button class="stop-btn" onclick="stopTimer(${index})">خاموش</button>
                    <button class="reset-btn" onclick="resetTimer(${index})">ریست</button>
                    <button class="snack-btn" onclick="openPopup(${index})">تنقلات</button>
                </div>
            `;
            return playerDiv;
        }

        function setRate(index, rateType) {
            hourlyRates[index] = rates[rateType];
            const buttons = document.querySelectorAll(`#players .player:nth-child(${index + 1}) .price-btn`);
            buttons.forEach(btn => btn.classList.remove("active"));
            document.querySelector(`#players .player:nth-child(${index + 1}) .price-btn:nth-child(${rateType === 'old' ? 1 : rateType === 'new' ? 2 : 3})`).classList.add("active");
            saveData();
        }

        function openPopup(index) {
            currentPlayerIndex = index;
            const popup = document.getElementById("snackPopup");
            const popupContent = document.getElementById("popupContent");
            popupContent.innerHTML = Object.keys(snacks).map(snack => `
                <div>
                    <span>${snack} - ${formatNumber(snacks[snack])} تومان</span>
                    <span class="snack-count" id="count${index}${snack}">${snackCounts[index][snack] || 0}</span>
                    <button onclick="addSnack(${index}, '${snack}', ${snacks[snack]})">+</button>
                    <button onclick="removeSnack(${index}, '${snack}', ${snacks[snack]})">-</button>
                </div>
            `).join("");
            popup.style.display = "block";
        }

        function closePopup() {
            const popup = document.getElementById("snackPopup");
            popup.style.display = "none";
            currentPlayerIndex = null;
        }

        function openIncomePopup() {
            const popup = document.getElementById("incomePopup");
            updateDailyIncome();
            popup.style.display = "block";
        }

        function closeIncomePopup() {
            const popup = document.getElementById("incomePopup");
            popup.style.display = "none";
        }

        function openAdminPopup() {
            const popup = document.getElementById("adminPopup");
            const adminContent = document.getElementById("adminContent");
            adminContent.innerHTML = `
                <div>
                    <input type="password" id="adminPassword" placeholder="رمز عبور">
                    <button onclick="checkAdminPassword()">ورود</button>
                </div>
            `;
            popup.style.display = "block";
            isAdminAuthenticated = false; // ریست وضعیت احراز هویت
        }

        function checkAdminPassword() {
            const password = document.getElementById("adminPassword").value;
            if (password === "admin123") {
                isAdminAuthenticated = true;
                showAdminPanel();
            } else {
                alert("رمز عبور اشتباه است!");
            }
        }

        function showAdminPanel() {
            const adminContent = document.getElementById("adminContent");
            adminContent.innerHTML = `
                <h2>تنظیمات قیمت</h2>
                <div>
                    <span>قیمت قدیم (تومان):</span>
                    <input type="number" id="oldPrice" value="${rates.old}">
                </div>
                <div>
                    <span>قیمت جدید (تومان):</span>
                    <input type="number" id="newPrice" value="${rates.new}">
                </div>
                <div>
                    <span>4 دسته (تومان):</span>
                    <input type="number" id="fourPlayersPrice" value="${rates.fourPlayers}">
                </div>
                <h2>تنقلات</h2>
                ${Object.keys(snacks).map(snack => `
                    <div>
                        <span>${snack}:</span>
                        <input type="number" id="snack_${snack}" value="${snacks[snack]}">
                    </div>
                `).join("")}
                <div>
                    <input type="text" id="newSnackName" placeholder="نام تنقلات جدید">
                    <input type="number" id="newSnackPrice" placeholder="قیمت (تومان)">
                    <button onclick="addNewSnack()">اضافه کردن</button>
                </div>
                <button onclick="saveAdminChanges()">ذخیره تغییرات</button>
            `;
        }

        function addNewSnack() {
            const name = document.getElementById("newSnackName").value;
            const price = parseInt(document.getElementById("newSnackPrice").value);
            if (name && price > 0) {
                snacks[name] = price;
                showAdminPanel(); // به‌روزرسانی پنل
            } else {
                alert("لطفاً نام و قیمت معتبر وارد کنید!");
            }
        }

        function saveAdminChanges() {
            rates.old = parseInt(document.getElementById("oldPrice").value) || rates.old;
            rates.new = parseInt(document.getElementById("newPrice").value) || rates.new;
            rates.fourPlayers = parseInt(document.getElementById("fourPlayersPrice").value) || rates.fourPlayers;
            Object.keys(snacks).forEach(snack => {
                const newPrice = parseInt(document.getElementById(`snack_${snack}`).value);
                if (newPrice > 0) snacks[snack] = newPrice;
            });
            saveData();
            closeAdminPopup();
            updatePlayers();
        }

        function closeAdminPopup() {
            const popup = document.getElementById("adminPopup");
            popup.style.display = "none";
            isAdminAuthenticated = false;
        }

        function updatePlayers() {
            const playersDiv = document.getElementById("players");
            playersDiv.innerHTML = "";
            for (let i = 0; i < players; i++) {
                playersDiv.appendChild(createPlayer(i));
            }
            for (let i = 0; i < players; i++) {
                document.getElementById(`total${i}`).textContent = formatNumber(Math.round(totals[i]));
                document.getElementById(`timer${i}`).textContent = formatTime(timers[i]);
                updateSnackCounts(i);
            }
        }

        function startTimer(index) {
            if (!intervals[index]) {
                intervals[index] = setInterval(() => {
                    timers[index]++;
                    totals[index] += hourlyRates[index] / 3600;
                    document.getElementById(`total${index}`).textContent = formatNumber(Math.round(totals[index]));
                    document.getElementById(`timer${index}`).textContent = formatTime(timers[index]);
                    updateGrandTotal();
                    saveData();
                }, 1000);
            }
        }

        function stopTimer(index) {
            clearInterval(intervals[index]);
            intervals[index] = null;
            saveData();
        }

        function resetTimer(index) {
            stopTimer(index);
            dailyIncome += totals[index];
            totals[index] = 0;
            timers[index] = 0;
            snackCounts[index] = {};
            document.getElementById(`total${index}`).textContent = "0";
            document.getElementById(`timer${index}`).textContent = formatTime(0);
            updateSnackCounts(index);
            updateGrandTotal();
            saveData();
        }

        function addSnack(index, snack, price) {
            snackCounts[index][snack] = (snackCounts[index][snack] || 0) + 1;
            totals[index] += price;
            document.getElementById(`total${index}`).textContent = formatNumber(Math.round(totals[index]));
            document.getElementById(`count${index}${snack}`).textContent = snackCounts[index][snack];
            updateGrandTotal();
            saveData();
        }

        function removeSnack(index, snack, price) {
            if (snackCounts[index][snack] > 0) {
                snackCounts[index][snack]--;
                totals[index] -= price;
                document.getElementById(`total${index}`).textContent = formatNumber(Math.round(totals[index]));
                document.getElementById(`count${index}${snack}`).textContent = snackCounts[index][snack];
                updateGrandTotal();
                saveData();
            }
        }

        function updateSnackCounts(index) {
            Object.keys(snacks).forEach(snack => {
                const countElement = document.getElementById(`count${index}${snack}`);
                if (countElement) {
                    countElement.textContent = snackCounts[index][snack] || 0;
                }
            });
        }

        // ایجاد دستگاه‌ها و بارگذاری اولیه
        const playersDiv = document.getElementById("players");
        for (let i = 0; i < players; i++) {
            playersDiv.appendChild(createPlayer(i));
        }
        loadData();
        for (let i = 0; i < players; i++) {
            document.getElementById(`total${i}`).textContent = formatNumber(Math.round(totals[i]));
            document.getElementById(`timer${i}`).textContent = formatTime(timers[i]);
            updateSnackCounts(i);
        }

        // بستن پاپ‌آپ‌ها با کلیک خارج
        document.addEventListener("click", (e) => {
            const snackPopup = document.getElementById("snackPopup");
            const incomePopup = document.getElementById("incomePopup");
            const adminPopup = document.getElementById("adminPopup");

            if (snackPopup.style.display === "block" && !snackPopup.contains(e.target) && !e.target.classList.contains("snack-btn")) {
                closePopup();
            }
            if (incomePopup.style.display === "block" && !incomePopup.contains(e.target) && !e.target.classList.contains("income-btn")) {
                closeIncomePopup();
            }
            if (adminPopup.style.display === "block" && !adminPopup.contains(e.target) && !e.target.classList.contains("admin-btn") && !e.target.tagName === "BUTTON" && isAdminAuthenticated) {
                closeAdminPopup();
            }
        });
    </script>
</body>
</html>
